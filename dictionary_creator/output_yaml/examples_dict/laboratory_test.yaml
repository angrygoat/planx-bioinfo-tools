$schema: "http://json-schema.org/draft-04/schema#"

id: "laboratory_test"
title: Laboratory Test
type: object
namespace: http://www.gen3.org
category: Biomarkers
program: '*'
project: '*'
description: >
  Collection of parameters associated to the Laboratory Test 
additionalProperties: false
submittable: true
validators: null

systemProperties:
  - id
  - project_id
  - state
  - created_datetime
  - updated_datetime

links:
  - name: samples
    backref: laboratory_tests,laboratory_tests
    label: data_from
    target_type: sample
    multiplicity: one_to_one
    required: false
  - name: cases
    backref: laboratory_tests,laboratory_tests
    label: performed_on
    target_type: case
    multiplicity: many_to_one
    required: true

uniqueKeys:
  - [id]
  - [project_id, submitter_id]

required:
  - submitter_id
  - type
  - cases

properties:
  $ref: "_definitions.yaml#/ubiquitous_properties"

  test_type:
    description: >
      Classification type for this test
    enum:
      - "Abnormal Laboratory Test"
      - "Blood Test Panel"
      - "Metabolomics"

  test_method:
    description: >
      Methodology followed to perform this laboratory test
    enum:
      - "ELISA"
      - "ESSI-MRM Profiling"
      - "Flow Cytometry"
      - "Enzyme Activity Assay"
      - "PS-MRM Profiling"
      - "SAVE Imaging"
      - "qRT-PCR"
      - "Expression Analysis"

  test_sample_type:
    description: >
      Type of the collected sample
    enum:
      - "Cerebrospinal Fluid"
      - "Plasma"
      - "Saliva"
      - "Serum"
      - "Whole Blood"
      - "Urine"

  test_status:
    description: >
      Test Status
    enum:
      - "Active"
      - "Inactive"

  abnormal_test_action_taken:
    description: >
      Action Taken Following Abnormal Laboratory Results
    enum:
      - "Observe"
      - "Reduction In Dosage"
      - "Change In Dosing Schedule"
      - "Discontinuation of Experimental Drugs"

  abnormal_test_exp_meds:
    description: >
      Abnormal Laboratory Test Related To Experimental Medication
    enum:
      - "Probably Not Related"
      - "Possibly Related"
      - "Definitely Related"
      - "Probably Related"

  abnormal_test_nonexp_meds:
    description: >
      Abnormal Laboratory Test Related To Non-Experimental Medication
    enum:
      - "Probably Not Related"
      - "Possibly Related"
      - "Definitely Related"
      - "Probably Related"

  abnormal_test_severity:
    description: >
      Severity of the Abnormal Laboratory Test
    enum:
      - "Mild"
      - "Moderate"
      - "Severe"

  acceptable_sample:
    description: >
      Is this sample acceptable?
    enum:
      - "Yes"
      - "No"

  needle_gauge:
    description: >
      Needle Size
    enum:
      - "22"
      - "20"
      - "19"
      - "18"
      - "Other"

  reason_sample_unnacceptable:
    description: >
      Reason why the sample was unacceptable
    enum:
      - "Inadequate Flow"
      - "Blood In Sample"
      - "Deviations From Collection"
      - "Other"
      - "More Than One"

  test_name:
    description: >
      Laboratory Test Name
    type: string

  days_to_sample_collection:
    description: >
      Days from Index Date to the Sample CollectionDate
    type: integer

  days_to_abnormal_test:
    description: >
      Days to an abnormal Laboratory Test
    type: integer

  year_of_abnormal_test:
    description: >
      Year of the Abnormal Laboratory Test
    type: integer

  year_of_test_form:
    description: >
      Year Of Form 6003 for Abnormal Laboratory Test
    type: integer

  test_code:
    description: >
      Laboratory Test Code
    type: string

  days_to_test:
    description: >
      Days From Index Date To Laboratory Test Date
    type: integer

  test_panel:
    description: >
      Laboratory Test Panel
    type: string

  text_if_repeated:
    description: >
      Laboratory text If Repeated
    type: string

  lumbar_puncture_hour:
    description: >
      Lumbar Puncture Time (Hour)
    type: integer

  lumbar_puncture_year:
    description: >
      Lumbar Puncture Year
    type: integer

  comments:
    description: >
      Blood Chemistry And Hematology Test Specific Comments
    type: string

  which_visit_being_performed:
    description: >
      Blood Chemistry And Hematology Test: Which Visit Being Performed
    type: string

  year_tests_obtained:
    description: >
      Year Laboratory Tests Obtained
    type: integer

  cases:
    $ref: "_definitions.yaml#/to_one"

  samples:
    $ref: "_definitions.yaml#/to_one"
